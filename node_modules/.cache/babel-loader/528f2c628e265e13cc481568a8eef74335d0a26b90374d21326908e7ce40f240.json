{"ast":null,"code":"import React,{useEffect,useState,useRef}from'react';import{NavLink,useNavigate}from'react-router-dom';import{useDispatch}from'react-redux';import{getRequest,postRequest}from'services/api';import{useLocaleOrders,useUser}from'../../redux/selectors';import{setProducts}from'../../redux/products';import{setOrders}from'../../redux/orders';import{setUser}from'../../redux/user';import*as i from'assets/icon';import'./style.css';import{setRooms}from'../../redux/rooms';import{useOutsideClick}from'utils/hooks';import{toast}from'react-toastify';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const links=[{label:'Joylar royxati',to:'/rooms'},{label:'Chiqish',to:'/',logout:true}];const Header=()=>{var _user$full_name;const headerModal=useRef();const user=useUser();const dispatch=useDispatch();const navigate=useNavigate();const[open,setOpen]=useState(false);const[loading,setLoading]=useState(false);const localeOrders=useLocaleOrders();const[confirmLogout,setConfirmLogout]=useState(false);useEffect(()=>{if(!user)navigate('/login',{replace:true});},[]);const getRoom=()=>{getRequest('room/get',user===null||user===void 0?void 0:user.token).then(_ref=>{let{data}=_ref;dispatch(setRooms(data===null||data===void 0?void 0:data.result));}).catch(err=>{console.log(err);});};const getProduct=()=>{getRequest('product/get',user===null||user===void 0?void 0:user.token).then(products=>{var _products$data;dispatch(setProducts(products===null||products===void 0?void 0:(_products$data=products.data)===null||_products$data===void 0?void 0:_products$data.result));}).catch(err=>{var _err$response,_err$response$data;console.log(err===null||err===void 0?void 0:(_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.result);setLoading(false);});};useEffect(()=>{getRoom();getProduct();},[user===null||user===void 0?void 0:user.token]);const handleExit=()=>{setOpen(false);dispatch(setUser(null));dispatch(setOrders([]));dispatch(setProducts([]));dispatch(setRooms([]));localStorage.clear();postRequest('auth/logout',{},user===null||user===void 0?void 0:user.token).then(_ref2=>{let{data}=_ref2;toast.info(data===null||data===void 0?void 0:data.result);}).catch(err=>{console.log(err);});navigate('/register',{replace:true});};useOutsideClick(headerModal,()=>setOpen(false));return/*#__PURE__*/_jsxs(\"header\",{children:[open&&/*#__PURE__*/_jsx(\"div\",{className:\"modal\",ref:headerModal,children:/*#__PURE__*/_jsxs(\"ul\",{className:\"list-bar\",children:[links.map(link=>/*#__PURE__*/_jsx(\"li\",{children:/*#__PURE__*/_jsxs(NavLink,{className:link.logout?'logout':undefined,onClick:()=>{setOpen(link.logout||false);if(link.logout){setConfirmLogout(true);}},to:link.to,children:[link.logout?/*#__PURE__*/_jsx(i.LogOut,{}):null,link.label]})},link.to)),confirmLogout&&/*#__PURE__*/_jsxs(\"div\",{className:\"absolute\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"reject\",onClick:handleExit,children:\"Ha\"}),/*#__PURE__*/_jsx(\"button\",{className:\"resolve\",onClick:()=>setConfirmLogout(false),children:\"Yo'q\"})]})]})}),/*#__PURE__*/_jsx(\"button\",{onMouseDown:e=>{e.stopPropagation();e.preventDefault();setOpen(!open);},children:/*#__PURE__*/_jsx(i.Menu,{})}),/*#__PURE__*/_jsxs(NavLink,{onClick:()=>setOpen(false),className:'profile-link',to:'/rooms',children:[/*#__PURE__*/_jsx(\"span\",{className:\"word-user\",children:loading?/*#__PURE__*/_jsx(\"div\",{className:\"lds-dual-ring\"}):(user===null||user===void 0?void 0:(_user$full_name=user.full_name)===null||_user$full_name===void 0?void 0:_user$full_name.slice(0,1))||'H'}),localeOrders!==null&&localeOrders!==void 0&&localeOrders.length?/*#__PURE__*/_jsx(\"span\",{className:\"count-orders\",children:(localeOrders===null||localeOrders===void 0?void 0:localeOrders.length)||''}):'']})]});};export default Header;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}